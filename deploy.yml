- apiVersion: apps/v1
  kind: Deployment
  metadata:
    labels:
      app: backend
    name: backend-deployment
  spec:
    replicas: 1
    selector:
      matchLabels:
        app: backend
    template:
      metadata:
        labels:
          app: backend
      spec:
        containers:
          - image: index.docker.io/taestarn/backend
            livenessProbe:
              httpGet:
                path: /healthcheck
                port: 4000
              initialDelaySeconds: 15
              timeoutSeconds: 30
            name: backend
            ports:
              - containerPort: 9000
                name: debug-port
              - containerPort: 4369
                name: epmd-port
              - containerPort: 4000
                name: backend-port
        imagePullSecrets:
          - name: regcred
- apiVersion: v1
  kind: Service
  metadata:
    name: backend-service
  spec:
    ports:
      - name: debug
        port: 9000
        protocol: TCP
        targetPort: debug-port
      - name: epmd
        port: 4369
        protocol: TCP
        targetPort: epmd-port
      - name: web
        port: 80
        protocol: TCP
        targetPort: backend-port
    selector:
      app: backend
    type: LoadBalancer
